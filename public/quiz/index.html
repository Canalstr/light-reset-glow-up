
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schlaf-Quiz | The Light Reset</title>
  <style>
    :root {
      --primary: #FF8A3D;
      --secondary: #F8F1E9;
      --dark: #333;
      --light: #fff;
      --border-radius: 12px;
      --shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    }
    body {
      background-color: #f5f5f7;
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 500px;
      background: var(--light);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
    }
    .progress-container {
      height: 8px;
      background: #eee;
      width: 100%;
    }
    .progress-bar {
      height: 100%;
      background: var(--primary);
      width: 0;
      transition: width 0.3s ease;
    }
    .card {
      display: none;
    }
    .card.active {
      display: block;
      animation: fadeIn 0.4s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .question {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
      color: var(--dark);
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .option {
      background: var(--secondary);
      border: 2px solid transparent;
      border-radius: var(--border-radius);
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .option:hover {
      background: #f0e6db;
    }
    .option.selected {
      border-color: var(--primary);
      background: rgba(255, 138, 61, 0.1);
    }
    .btn-container {
      display: flex;
      justify-content: space-between;
      margin-top: 24px;
    }
    .btn {
      background: var(--primary);
      color: var(--light);
      border: none;
      border-radius: var(--border-radius);
      padding: 12px 24px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .btn:hover {
      background: #e67a2d;
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .btn-back {
      background: transparent;
      color: var(--dark);
    }
    input[type="email"], input[type="tel"] {
      width: 100%;
      padding: 16px;
      border: 2px solid #ddd;
      border-radius: var(--border-radius);
      font-size: 16px;
      margin-bottom: 16px;
    }
    input[type="email"]:focus, input[type="tel"]:focus {
      border-color: var(--primary);
      outline: none;
    }
    .result {
      text-align: center;
      padding: 32px 24px;
    }
    .result h2 {
      margin-bottom: 16px;
      color: var(--primary);
      font-size: 28px;
    }
    .result p {
      margin-bottom: 24px;
    }
    .result ul {
      text-align: left;
      margin: 20px 0;
      padding-left: 20px;
    }
    .result li {
      margin-bottom: 10px;
    }
    .result .disclaimer {
      font-size: 12px;
      color: #777;
      margin-top: 20px;
      font-style: italic;
    }
    .scale {
      display: flex;
      justify-content: space-between;
      margin: 24px 0;
    }
    .scale-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 20%;
      cursor: pointer;
    }
    .scale-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #ddd;
      margin-bottom: 8px;
      transition: all 0.2s ease;
    }
    .scale-option.selected .scale-dot {
      border-color: var(--primary);
      background: var(--primary);
    }
    .scale-label {
      font-size: 12px;
      text-align: center;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .modal-content {
      background: var(--light);
      border-radius: var(--border-radius);
      max-width: 500px;
      width: 100%;
      padding: 24px;
      position: relative;
    }
    .modal-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    .checkbox-container {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin: 20px 0;
    }
    .checkbox-container input {
      margin-top: 4px;
    }
    .fine-print {
      font-size: 12px;
      color: #666;
      margin-top: 12px;
      text-align: center;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <input type="hidden" id="refID" name="refID" value="">
  
  <div class="container" id="quiz-container">
    <div class="progress-container">
      <div class="progress-bar" id="progress"></div>
    </div>
    
    <!-- Question 1 -->
    <div class="card active" id="q1">
      <div class="question">Wann wachst du an Arbeitstagen normalerweise auf?</div>
      <div class="options">
        <div class="option" onclick="selectOption(this, 0)" data-value="0">05‚Äì06 Uhr</div>
        <div class="option" onclick="selectOption(this, 0)" data-value="1">06‚Äì07 Uhr</div>
        <div class="option" onclick="selectOption(this, 0)" data-value="2">07‚Äì08 Uhr</div>
        <div class="option" onclick="selectOption(this, 0)" data-value="3">Nach 08 Uhr</div>
      </div>
      <div class="btn-container">
        <div></div> <!-- Spacer for alignment -->
        <button class="btn" onclick="nextQuestion(1, 2)" id="q1-next">Weiter</button>
      </div>
    </div>
    
    <!-- Question 2 -->
    <div class="card" id="q2">
      <div class="question">Wie lange brauchst du aktuell, um einzuschlafen?</div>
      <div class="options">
        <div class="option" onclick="selectOption(this, 1)" data-value="0"><10 Min</div>
        <div class="option" onclick="selectOption(this, 1)" data-value="1">10‚Äì20 Min</div>
        <div class="option" onclick="selectOption(this, 1)" data-value="2">20‚Äì40 Min</div>
        <div class="option" onclick="selectOption(this, 1)" data-value="3">>40 Min</div>
      </div>
      <div class="btn-container">
        <button class="btn btn-back" onclick="prevQuestion(2, 1)">Zur√ºck</button>
        <button class="btn" onclick="nextQuestion(2, 3)" id="q2-next">Weiter</button>
      </div>
    </div>
    
    <!-- Question 3 -->
    <div class="card" id="q3">
      <div class="question">Wie viele Kaffees / Colas / Energy-Drinks trinkst du t√§glich NACH 14 Uhr?</div>
      <div class="options">
        <div class="option" onclick="selectOption(this, 2)" data-value="0">0</div>
        <div class="option" onclick="selectOption(this, 2)" data-value="1">1</div>
        <div class="option" onclick="selectOption(this, 2)" data-value="2">2‚Äì3</div>
        <div class="option" onclick="selectOption(this, 2)" data-value="3">>3</div>
      </div>
      <div class="btn-container">
        <button class="btn btn-back" onclick="prevQuestion(3, 2)">Zur√ºck</button>
        <button class="btn" onclick="nextQuestion(3, 'qLead')" id="q3-next">Weiter</button>
      </div>
    </div>
    
    <!-- Lead Capture -->
    <div class="card" id="qLead">
      <div class="question">Wohin d√ºrfen wir deinen Schlaf-Report schicken?</div>
      <input type="email" id="email" placeholder="deine@email.de" required>
      <input type="tel" id="leadPhone" placeholder="+49 123 4567890">
      <div class="btn-container">
        <button class="btn btn-back" onclick="prevQuestion('qLead', 3)">Zur√ºck</button>
        <button class="btn" onclick="completeQuiz()">Ergebnisse anzeigen</button>
      </div>
    </div>
    
    <!-- Results -->
    <div class="result" id="result">
      <div id="outcome-content">
        <h2 id="result-title"></h2>
        <div id="result-description"></div>
        <button class="btn" id="btnPay" onclick="showModal()">Starte jetzt f√ºr 15 ‚Ç¨</button>
        <p class="disclaimer" id="result-disclaimer"></p>
      </div>
    </div>
  </div>
  
  <!-- Payment Modal -->
  <div class="modal" id="payment-modal">
    <div class="modal-content">
      <div class="modal-title">Best√§tigung</div>
      <div class="checkbox-container">
        <input type="checkbox" id="waive-rights" onchange="toggleButton()">
        <label for="waive-rights">Ich verlange die sofortige Bereitstellung der digitalen Inhalte und verliere mein 14-t√§giges Widerrufsrecht (¬ß 356 Abs. 5 BGB).</label>
      </div>
      <div class="btn-container">
        <button class="btn btn-back" onclick="closeModal()">Abbrechen</button>
        <button class="btn" id="btnGo" disabled onclick="proceedToPayment()">Weiter zur Zahlung</button>
      </div>
      <p class="fine-print">‚Ç¨15 heute ‚Ä¢ automatische Verl√§ngerung ‚Ç¨199/Quartal ab Tag 7 ‚Ä¢ jederzeit k√ºndbar</p>
    </div>
  </div>

  <script>
    // Get refID from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const refID = urlParams.get('refID') || '';
    document.getElementById('refID').value = refID;
    
    // Quiz data storage
    const quizData = {
      answers: [null, null, null],
      email: '',
      phone: '',
      outcome: '',
      score: 0,
      refID: refID
    };
    
    // Current question tracking
    let currentQuestion = 1;
    
    // Option selection handler
    function selectOption(element, questionIndex) {
      // Remove selected class from all siblings
      const parent = element.parentElement;
      const options = parent.querySelectorAll('.option');
      options.forEach(opt => opt.classList.remove('selected'));
      
      // Add selected class to clicked option
      element.classList.add('selected');
      
      // Store value
      quizData.answers[questionIndex] = parseInt(element.getAttribute('data-value'));
      
      // Enable next button (always enabled now)
      const nextButton = document.getElementById(`q${questionIndex + 1}-next`);
      if (nextButton) {
        nextButton.disabled = false;
      }
      
      // Auto-progress to next question after brief delay
      setTimeout(() => {
        if (questionIndex < 3) { // Only auto-progress for questions 1-3
          let nextQ = questionIndex + 2;
          if (questionIndex === 2) nextQ = 'qLead';
          nextQuestion(questionIndex + 1, nextQ);
        }
      }, 500);
    }
    
    // Navigation functions
    function nextQuestion(current, next) {
      document.getElementById(`q${current}`).classList.remove('active');
      document.getElementById(`${next}`).classList.add('active');
      currentQuestion = next === 'qLead' ? 4 : next;
      updateProgressBar();
    }
    
    function prevQuestion(current, prev) {
      document.getElementById(`${current}`).classList.remove('active');
      document.getElementById(`q${prev}`).classList.add('active');
      currentQuestion = prev;
      updateProgressBar();
    }
    
    // Update progress bar
    function updateProgressBar() {
      const totalQuestions = 4; // Now only 3 questions + lead capture
      const progressPercent = ((currentQuestion - 1) / totalQuestions) * 100;
      document.getElementById('progress').style.width = `${progressPercent}%`;
    }
    
    // Complete quiz and show results
    function completeQuiz() {
      // Validate email
      const em = document.getElementById('email').value.trim();
      if (!em || !em.includes('@')) {
        alert('Bitte gib eine g√ºltige E-Mail-Adresse ein.');
        return;
      }
      
      quizData.email = em;
      
      // Get phone number if provided
      quizData.phone = document.getElementById('leadPhone').value.trim();
      
      // Calculate score
      const answers = quizData.answers;
      quizData.score = answers.reduce((a, b) => a + b, 0);
      
      // Determine outcome
      let outcome, title, description, disclaimer;
      const disclaimerText = "*Ergebnisse k√∂nnen individuell variieren. Kein medizinischer Rat; bei ernsthaften Schlafst√∂rungen bitte Arzt konsultieren.";
      
      if (quizData.score <= 3) {
        outcome = 'early_bird';
        title = 'Fr√ºhaufsteher';
        description = `
          <p>Fr√ºh wach, trotzdem schlapp? Hol dir +15 Minuten Tiefschlaf* ‚Äì jede Nacht!</p>
          <p>Mit drei Mikro-Tweaks aus dem Licht-Sprint System steigern Fr√ºhaufsteher ihren Tiefschlaf um 10‚Äì15 Minuten ab der ersten Anwendung.</p>
          
          <h3 style="margin-top:20px;font-size:18px;">Dein 5-Minuten Setup</h3>
          <ul>
            <li>Lichtfenster-Hack: programmier deine innere Uhr neu</li>
            <li>Sunrise-Switch: reduziere Cortisol-Spitzen am Morgen</li>
            <li>Sleep-Shield: blockiere st√∂rendes Blaulicht ab 20 Uhr</li>
          </ul>
          
          <p style="margin-top:20px;font-weight:600;">Ergebnis: Mehr Fokus, bessere Laune, weniger Kaffee-Crash ‚Äì garantiert oder Geld zur√ºck.</p>
        `;
      } else if (quizData.score >= 7) {
        outcome = 'night_owl';
        title = 'Sp√§te Eule';
        description = `
          <p>‚ö†Ô∏è SCHLAF-ALARM: Deine Nacht-Eulen-Gene rauben dir bis zu 3,5 Stunden Schlaf pro Woche!</p>
          <p>Aktiviere jetzt das Licht-Sprint System und verk√ºrze deine Einschlafzeit im Schnitt um 27‚Äì30 Minuten ‚Äì 100 % nat√ºrlich, ohne Pillen.</p>
          
          <h3 style="margin-top:20px;font-size:18px;">Was dich heute Nacht erwartet</h3>
          <ul>
            <li>Wirkt ab Minute 1: Richtige Lichtfrequenz = sofort weniger Gr√ºbeln</li>
            <li>Mehr Energie am Morgen: +18 % h√∂herer Wachheits-Score bei Testern*</li>
            <li>Null Risiko: 14-Tage-Geld-zur√ºck-Versprechen</li>
          </ul>
          
          <p style="margin-top:20px;">2 374 ‚ÄûEulen" haben den Hack bereits freigeschaltet. 92 % w√ºrden ihn ihrem besten Freund empfehlen.*</p>
        `;
      } else {
        outcome = 'intermediate';
        title = 'Goldene Mitte';
        description = `
          <p>Gl√ºckwunsch! Dein Chronotyp bietet das h√∂chste Upgrade-Potenzial.</p>
          <p>Tester mit deinem Profil schliefen 23 Minuten schneller ein* ‚Äì nach nur 7 Tagen mit dem Licht-Sprint System.</p>
          
          <h3 style="margin-top:20px;font-size:18px;">Stell dir das in 1 Woche vor</h3>
          <ul>
            <li>‚è≥ 23 Minuten schneller wegd√§mmern = +2,7 Stunden Extra-Schlaf/Woche*</li>
            <li>üí° 100 % nat√ºrlich, nur mit gezieltem Lichteinsatz</li>
            <li>üí∞ Einmal zahlen, lebenslang nutzen ‚Äì Updates inklusive</li>
          </ul>
          
          <p style="margin-top:20px;font-style:italic;">"Ich h√§tte nie gedacht, dass Licht SO einen Unterschied macht." ‚Äì Laura, 34</p>
        `;
      }
      
      // Store outcome
      quizData.outcome = outcome;
      
      // Update result screen
      document.getElementById('result-title').textContent = title;
      document.getElementById('result-description').innerHTML = description;
      document.getElementById('result-disclaimer').textContent = disclaimerText;
      
      // Show result screen
      document.getElementById('qLead').classList.remove('active');
      document.getElementById('result').classList.add('active');
      
      // Update progress to 100%
      document.getElementById('progress').style.width = '100%';
      
      // Send data to Google script
      fetch('https://script.google.com/macros/s/AKfycbwcC9MwWaDkfDMQ82Y1kg6MuG-GJyHP7nWCKbXD99uZuEWiUUIPT34HyV7NDBuY81As/exec', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email: em, phone: document.getElementById('leadPhone').value, score: answers})
      })
      .catch(error => console.error('Error sending data:', error));
    }
    
    // Modal functions
    function showModal() {
      document.getElementById('payment-modal').style.display = 'flex';
    }
    
    function closeModal() {
      document.getElementById('payment-modal').style.display = 'none';
    }
    
    function toggleButton() {
      document.getElementById('btnGo').disabled = !document.getElementById('waive-rights').checked;
    }
    
    // Handle payment
    function proceedToPayment() {
      // Redirect to Stripe
      const stripeUrl = `https://buy.stripe.com/4gM00k7Ti9Yj2rya1jdZ601?prefilled_email=${encodeURIComponent(quizData.email)}&client_reference_id=${encodeURIComponent(quizData.refID)}`;
      window.location.href = stripeUrl;
    }
    
    // Initialize progress bar
    updateProgressBar();
  </script>
</body>
</html>
